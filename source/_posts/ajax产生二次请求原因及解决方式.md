---
title: ajax产生二次请求原因及解决方式
date: 2019-07-30 14:54:44
tags:
---
<div class="post-block"><link itemprop="mainEntityOfPage" href="http://cmszlx.win/2019/07/30/ajax产生二次请求原因及解决方式/"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="name" content="linXiao"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.gif"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Hurry"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span><span class="post-meta-item-text">发表于</span><time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-30T17:49:44+08:00"> 2019年07月30日 </time></span></div></header><div class="post-body" itemprop="articleBody"><blockquote><p>二次请求一般是指发送正确请求之前，额外发送了一次OPTIONS请求。</p></blockquote><p>OPTIONS请求，也叫预检请求和嗅探请求，目的是为了检测要发送的真正请求是否是服务器允许的请求，如果服务器不允许，则会停止发送真正的请求。<br>产生OPTIONS请求的原因，首先是这个请求是<code>跨域请求</code>，因为只有在<code>CORS跨域资源共享</code>场景下，服务器http header中会有一个叫“Access-Control-Allow-Origin”的字段，该字段规定了指定的客户端来源才能对服务器资源进行访问，那么在这个来源之内的所有请求，都是CORS跨域资源共享模式，但是在这个模式下，服务器也不是完全相信客户端的，对那些可能对服务器数据产生副作用的 HTTP 请求方法（特别是 GET 以外的 HTTP 请求，或者搭配某些 MIME 类型的 POST 请求），即非简单请求，浏览器必须首先使用 OPTIONS 方法发起一个预检请求，如果预检不通过，服务器还是会拒绝浏览器的请求。</p><blockquote><p>非简单请求定义：</p><ol><li>使用除GET、HEAD、POST方法之外的其他请求类型如PUT DELETE 等。</li><li>人为设置了下列列表之外的其他header字段：</li></ol><ul><li>Accept</li><li>Accept-Language</li><li>Content-Language</li><li>Content-Type （application/x-www-form-urlencoded、multipart/form-data、text/plain之外）</li><li>DPR</li><li>Downlink</li><li>Save-Data</li><li>Viewport-Width</li><li>Width</li></ul></blockquote><p>若发送了非简单请求，则会产生嗅探请求。<br>解决方式：</p><ol><li>可以将发送的请求改为简单请求</li><li>或者将客户端与服务端部署在同一个ip地址下或者使用请求代理让其不产生跨域</li><li>或者在服务器CORS header中的Access-Control-Allow-Methods字段中，增加对OPTIONS的支持，后者只会让所有OPTIONS请求通过，而不会去除OPTIONS请求。</li></ol></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2019/07/30/js观察者模式如何实现/" rel="next" title="js观察者模式如何实现"><i class="fa fa-chevron-left"></i> js观察者模式如何实现 </a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2019/07/30/用css实现玻璃磨砂效果/" rel="prev" title="用css实现玻璃磨砂效果"> 用css实现玻璃磨砂效果 <i class="fa fa-chevron-right"></i></a></div></div></footer></div>

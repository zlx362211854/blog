---
title: javascript是单线程语言，那他的异步机制是怎么实现的？
date: 2019-07-30 14:54:59
tags:
---
<div class="post-block"><link itemprop="mainEntityOfPage" href="http://cmszlx.win/2019/07/30/javascript是单线程语言，那他的异步机制是怎么实现的？/"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="name" content="linXiao"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.gif"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Hurry"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span></span></div></header><div class="post-body" itemprop="articleBody"><p>javascript单线程就是在一个javascript运行环境中(如:浏览器，nodejs)只能同时运行一个javascript线程，那么单线程的语言的异步机制是如何实现的？<br>javascript是一个事件驱动的语言，他的异步机制与事件机制相关。</p><h3 id="在javascript中，有一个主线程和一个异步队列池，并且异步队列池中的事件，需要等到主线程执行完毕才执行。"><a href="#在javascript中，有一个主线程和一个异步队列池，并且异步队列池中的事件，需要等到主线程执行完毕才执行。" class="headerlink" title="在javascript中，有一个主线程和一个异步队列池，并且异步队列池中的事件，需要等到主线程执行完毕才执行。"></a>在javascript中，有一个主线程和一个异步队列池，并且异步队列池中的事件，需要等到主线程执行完毕才执行。</h3><ul><li>主线程，就是执行所有js同步代码的线程。</li><li>当js遇到异步操作时，会将异步操作推送到一个异步队列中，这个异步操作具体要做的事情，由js的宿主去执行，怎么理解呢？如浏览器发送一个ajax，js只需要将发送请求提交给浏览器，然后注册一个回调事件，浏览器会用多线程去发送真正的http请求，等到请求完成，再通知js异步队列中的指定回调，js再去通知代码中的回调，这样一个完整的异步操作就完成了,再如nodejs异步读取文件，js只需要发送一个读取文件的请求，然后nodejs会将读取文件的请求提交给他的宿主，nodejs中依赖libuv去执行I/O，然后js继续执行主线程的代码，等到I/O完成，则通知监听的代码。</li></ul><p>所以，js异步的实现其实很简单，js本身的功能并不强大，他只是借助了他的宿主环境去执行他的指令，宿主根本上也是多线程去执行的，只是对于js语言的机制来说，他是单线程。<br>上面说到，异步队列池中事件的执行，只有等主线程执行完毕以后才会执行，举个例子，setTimeout是异步操作。</p><precode language="javascript" precodenum="0"></precode><p>上面代码定义了一个异步事件，将在1s后打印一个log。但是假如我们主线程中有代码需要执行超过1s，那log会不会按时打印呢？</p><precode language="javascript" precodenum="1"></precode><p>执行上面的代码，可以看到，log在5s后才被打印，也就是setTimeout并不一定准时执行，只是我们在一般的项目中，不会遇到主线程被阻塞很长时间的情况，感觉不到setTimeout的延迟。这就是上面说到的，<code>异步队列池中的事件，需要等到主线程执行完毕才执行</code>，也就是同步任务会阻塞接下来的代码执行。所以我们平时在编码的过程中，遇到大数据量的处理，或者遇到需要很长时间才能执行完毕的操作，尽量使用异步操作。</p></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2019/07/30/css画三角/" rel="next" title="css画三角"><i class="fa fa-chevron-left"></i> css画三角 </a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2019/07/30/setTimeout、Promise、Async-Await-的区别/" rel="prev" title="setTimeout、Promise、Async/Await 的区别"> setTimeout、Promise、Async/Await 的区别 <i class="fa fa-chevron-right"></i></a></div></div></footer></div>
